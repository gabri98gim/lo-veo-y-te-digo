---
import Layout from "../layouts/Layout.astro";

// 1. LEEMOS LA CLAVE SECRETA DEL ARCHIVO .env
// Astro la carga automáticamente si el archivo se llama .env
const apiKey = import.meta.env.TMDB_API_KEY;

// 2. HACEMOS LA LLAMADA A LA API (FETCH)
// Pedimos películas "upcoming" (estrenos) en español
const response = await fetch(
	`https://api.themoviedb.org/3/movie/upcoming?api_key=${apiKey}&language=es-ES&page=1`,
);
const data = await response.json();
const movies = data.results; // Aquí están las 20 pelis

// URL base para cargar las imágenes de TMDB (ellos te dan solo el final de la ruta)
const imageBase = "https://image.tmdb.org/t/p/w500";
---

<Layout title="Próximos Estrenos | Lo veo y te digo">
	<section class="mb-12">
		<h1
			class="font-serif text-4xl font-bold text-gray-900 dark:text-white mb-4"
		>
			Próximos Estrenos
		</h1>
		<p class="text-gray-600 dark:text-gray-400 max-w-2xl text-lg">
			Las películas que están a punto de llegar a la cartelera. Datos en
			tiempo real gracias a TMDB.
		</p>
	</section>

	<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
		{
			movies.map((movie: any) => (
				<article class="group relative">
					<div class="aspect-[2/3] overflow-hidden rounded-lg bg-gray-200 dark:bg-gray-800 mb-3 shadow-sm hover:shadow-xl transition-all duration-300">
						{movie.poster_path ? (
							<img
								src={`${imageBase}${movie.poster_path}`}
								alt={`Póster de ${movie.title}`}
								class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
							/>
						) : (
							/* Fallback si no hay imagen */
							<div class="w-full h-full flex items-center justify-center text-gray-400 text-xs">
								Sin imagen
							</div>
						)}

						<div class="absolute top-2 right-2 bg-black/80 backdrop-blur text-white text-xs font-bold px-2 py-1 rounded border border-white/20">
							{Math.round(movie.vote_average * 10) / 10} ★
						</div>
					</div>

					<h3 class="font-bold text-gray-900 dark:text-white leading-tight group-hover:text-cine-gold transition-colors">
						{movie.title}
					</h3>
					<p class="text-xs text-gray-500 mt-1">
						Estreno: {movie.release_date}
					</p>

					<p class="text-xs text-gray-500 mt-2 line-clamp-2 hidden md:block">
						{movie.overview}
					</p>
				</article>
			))
		}
	</div>
</Layout>
